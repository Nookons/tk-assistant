<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Barlow:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        body{background:#0d0d0d;color:#e0e0e0;font-family:'Barlow',sans-serif;min-height:100vh;padding-bottom:80px}
        ::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:#111}::-webkit-scrollbar-thumb{background:#2a2a2a}
        input,select,textarea{background:#0a0a0a;border:1px solid #222;color:#e0e0e0;padding:8px 10px;font-size:13px;font-family:'Barlow',sans-serif;border-radius:2px;outline:none;width:100%;transition:border .15s}
        input:focus,select:focus,textarea:focus{border-color:#ff6b35}
        textarea{resize:vertical}
        input::placeholder,textarea::placeholder{color:#2a2a2a}
        select option{background:#111}

        /* Header */
        .hdr{background:#111;border-bottom:2px solid #1a1a1a;padding:14px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:20}
        .hdr .sub{font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:3px;color:#ff6b35;text-transform:uppercase;margin-bottom:2px}
        .hdr .title{font-weight:700;font-size:19px;color:#fff;letter-spacing:-.5px}
        .hdr-btns{display:flex;gap:8px}

        /* Buttons */
        .btn{padding:7px 18px;font-size:10px;letter-spacing:1.5px;font-family:'Share Tech Mono',monospace;cursor:pointer;border-radius:2px;text-transform:uppercase;border:1px solid #2a2a2a;background:transparent;color:#666;transition:.15s}
        .btn:hover{border-color:#ff6b35;color:#ff6b35}
        .btn.on{background:#ff6b35;border-color:#ff6b35;color:#000;font-weight:700}
        .btn-blue{background:#1a6fa8;border:1px solid #1a6fa8;color:#fff;font-weight:700;padding:7px 18px;font-size:10px;letter-spacing:1.5px;font-family:'Share Tech Mono',monospace;cursor:pointer;border-radius:2px;text-transform:uppercase;transition:.15s}
        .btn-blue:hover{background:#155c8a}
        .btn-ghost{background:transparent;border:1px dashed #2a2a2a;color:#444;padding:6px 14px;font-size:10px;letter-spacing:1.5px;font-family:'Share Tech Mono',monospace;cursor:pointer;border-radius:2px;text-transform:uppercase;transition:.15s;margin-top:4px}
        .btn-ghost:hover{border-color:#ff6b35;color:#ff6b35}
        .btn-x{background:transparent;border:1px solid #1e1e1e;color:#333;width:26px;height:26px;cursor:pointer;border-radius:2px;font-size:15px;flex-shrink:0;transition:.15s;display:flex;align-items:center;justify-content:center;line-height:1}
        .btn-x:hover{border-color:#9b2335;color:#c0392b}
        .btn-gen{background:#ff6b35;border:none;color:#000;padding:12px 40px;font-size:11px;letter-spacing:2px;font-family:'Share Tech Mono',monospace;cursor:pointer;border-radius:2px;text-transform:uppercase;font-weight:700;display:block;margin:12px auto 0;transition:.15s}
        .btn-gen:hover{background:#e5601f}
        .count-btn{background:transparent;border:none;color:#ff6b35;font-size:20px;cursor:pointer;padding:0 6px;line-height:1;font-weight:700;transition:.15s}
        .count-btn:hover{color:#fff}

        /* Layout */
        .wrap{max-width:920px;margin:0 auto;padding:22px 16px}
        .card{background:#111;border:1px solid #1e1e1e;border-radius:3px;margin-bottom:20px;overflow:hidden}
        .card-head{background:#161616;border-bottom:1px solid #1e1e1e;padding:10px 16px;display:flex;align-items:center;gap:10px}
        .card-head .ico{font-size:15px}
        .card-head .ttl{font-family:'Share Tech Mono',monospace;font-size:10px;letter-spacing:2.5px;color:#ff6b35;text-transform:uppercase;flex:1}
        .card-body{padding:16px}
        .lbl{font-size:9px;letter-spacing:1.5px;color:#444;text-transform:uppercase;font-family:'Share Tech Mono',monospace;margin-bottom:4px}
        .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
        .hint{font-size:10px;color:#333;font-family:'Share Tech Mono',monospace;letter-spacing:.8px;margin-bottom:12px}

        /* Workers */
        .workers-top{display:flex;align-items:center;gap:12px;margin-bottom:14px;flex-wrap:wrap}
        .count-box{display:flex;align-items:center;gap:4px;background:#0a0a0a;border:1px solid #222;border-radius:2px;padding:3px 8px}
        .count-val{font-family:'Share Tech Mono',monospace;font-size:15px;color:#fff;min-width:22px;text-align:center}
        .workers-head{display:grid;grid-template-columns:32px 1fr 80px 1fr;gap:8px;margin-bottom:6px;padding:0 2px}
        .workers-list{display:flex;flex-direction:column;gap:7px}
        .worker-row{display:grid;grid-template-columns:32px 1fr 80px 1fr;gap:8px;align-items:center}
        .worker-num{font-family:'Share Tech Mono',monospace;font-size:11px;color:#333;text-align:center}

        /* Work categories */
        .work-item{background:#0a0a0a;border:1px solid #1e1e1e;border-radius:2px;padding:12px;margin-bottom:10px}
        .work-top{display:flex;align-items:center;gap:6px;margin-bottom:10px;flex-wrap:wrap}
        .work-num{font-family:'Share Tech Mono',monospace;font-size:10px;color:#333;flex-shrink:0}
        .cat-tag{padding:3px 9px;font-size:9px;letter-spacing:1px;font-family:'Share Tech Mono',monospace;cursor:pointer;border-radius:2px;text-transform:uppercase;border:1px solid #222;background:transparent;color:#444;transition:.12s}
        .cat-tag:hover{border-color:#666;color:#999}
        .cat-tag.sel{border-color:#ff6b35;color:#ff6b35;background:#1f0f00}
        .work-fields{display:flex;gap:10px}

        /* Anomaly card */
        .anom-card{background:#0a0a0a;border:1px solid #1e1e1e;border-radius:2px;padding:12px;margin-bottom:9px}
        .anom-card.warning{border-left:3px solid #b8860b}
        .anom-card.info{border-left:3px solid #1a5276}
        .anom-top{display:flex;gap:8px;align-items:center;margin-bottom:8px}

        /* Critical incidents */
        .crit-card{background:#0a0a0a;border:1px solid #1e1e1e;border-left:3px solid #9b2335;border-radius:2px;padding:12px;margin-bottom:9px}
        .crit-top{display:flex;gap:8px;align-items:center;margin-bottom:8px}

        /* Shein card */
        .shein-card{background:#0a0a0a;border:1px solid #1e1e1e;border-left:3px solid #8e44ad;border-radius:2px;padding:12px;margin-bottom:9px}
        .shein-top{display:flex;gap:8px;align-items:center;margin-bottom:8px}

        /* Preview */
        #previewBlock{display:none}
        .prev-actions{display:flex;gap:10px;justify-content:flex-end;margin-bottom:16px}

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           PDF DOCUMENT
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        #pdfDoc{background:#fff;color:#111;font-family:'Barlow',sans-serif;padding:38px 44px;border:1px solid #ddd;border-radius:3px;line-height:1.5}

        .pdh{display:flex;justify-content:space-between;align-items:flex-start;border-bottom:3px solid #111;padding-bottom:14px;margin-bottom:24px}
        .pdh-brand .s{font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:3px;color:#ff6b35;text-transform:uppercase}
        .pdh-brand .t{font-size:22px;font-weight:700;color:#111;letter-spacing:-.5px;margin-top:2px}
        .pdh-meta{text-align:right;font-family:'Share Tech Mono',monospace;font-size:11px;color:#777}
        .pdh-meta b{display:block;font-size:13px;color:#111;margin-bottom:3px}

        .pds{margin-bottom:24px}
        .pds-title{font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:2.5px;text-transform:uppercase;color:#ff6b35;background:#fff7f3;border-left:3px solid #ff6b35;padding:6px 12px;margin-bottom:12px}

        /* Staff inline in PDF */
        .pdf-staff-box{background:#f8f8f8;border:1px solid #eee;border-radius:3px;padding:12px 16px}
        .pdf-staff-label{font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:1.5px;color:#aaa;text-transform:uppercase;margin-bottom:8px}
        .pdf-staff-names{display:flex;flex-wrap:wrap;gap:8px}
        .pdf-name-chip{background:#fff;border:1px solid #ddd;border-radius:2px;padding:4px 12px;font-size:12.5px;font-weight:500;color:#222}
        .pdf-staff-count{margin-top:10px;font-family:'Share Tech Mono',monospace;font-size:10px;color:#999}

        /* Work table */
        .pdf-tbl{width:100%;border-collapse:collapse;font-size:12.5px}
        .pdf-tbl th{background:#111;color:#fff;padding:8px 12px;text-align:left;font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:1.5px;text-transform:uppercase;font-weight:400}
        .pdf-tbl td{padding:8px 12px;border-bottom:1px solid #f0f0f0;vertical-align:top;color:#222}
        .pdf-tbl tr:last-child td{border-bottom:none}
        .pdf-tbl tr:nth-child(even) td{background:#fafafa}

        /* Badges */
        .badge{display:inline-block;padding:2px 8px;border-radius:2px;font-family:'Share Tech Mono',monospace;font-size:9px;letter-spacing:.8px;font-weight:700;text-transform:uppercase}
        .b-crit{background:#fdecea;color:#9b2335;border:1px solid #f5b7b1}
        .b-warn{background:#fef9e7;color:#9a7d0a;border:1px solid #f9e79f}
        .b-info{background:#eaf4fb;color:#1a5276;border:1px solid #aed6f1}
        .b-equip{background:#fef5e7;color:#d35400;border:1px solid #f8c471}
        .b-ops{background:#eaf4fb;color:#1a5276;border:1px solid #aed6f1}
        .b-safety{background:#fdecea;color:#922b21;border:1px solid #f5b7b1}
        .b-other{background:#f2f3f4;color:#555;border:1px solid #d5d8dc}
        .chip{display:inline-block;padding:3px 9px;background:#f5f5f5;border:1px solid #ddd;border-radius:2px;font-size:10px;font-family:'Share Tech Mono',monospace;color:#555;text-transform:uppercase;letter-spacing:.8px}

        /* PDF items */
        .pdf-item{border-radius:3px;padding:11px 14px;margin-bottom:8px;font-size:12.5px}
        .pdf-item.crit{background:#fdecea;border-left:3px solid #c0392b}
        .pdf-item.warn{background:#fef9e7;border-left:3px solid #d4ac0d}
        .pdf-item.info{background:#eaf4fb;border-left:3px solid #2980b9}
        .pdf-item.shein{background:#f9f0ff;border-left:3px solid #8e44ad}
        .pdf-item-head{display:flex;align-items:center;gap:8px;margin-bottom:5px}
        .pdf-item-text{color:#333;line-height:1.55}
        .pdf-item-sub{color:#888;font-size:11px;margin-top:4px;font-family:'Share Tech Mono',monospace}

        .pdf-footer{margin-top:28px;padding-top:12px;border-top:1px solid #e5e5e5;display:flex;justify-content:space-between;font-size:10px;color:#bbb;font-family:'Share Tech Mono',monospace}

        /* Print */
        @media print{
            *{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important}
            body{background:#fff!important;padding:0}
            .hdr,.prev-actions{display:none!important}
            #previewBlock{display:block!important}
            #pdfDoc{border:none;padding:18px;margin:0}
            .pdf-tbl th{background:#111!important;color:#fff!important}
            .pdf-item.crit{background:#fdecea!important}
            .pdf-item.warn{background:#fef9e7!important}
            .pdf-item.info{background:#eaf4fb!important}
            .pdf-item.shein{background:#f9f0ff!important}
            .pdf-tbl tr:nth-child(even) td{background:#fafafa!important}
            .pds-title{background:#fff7f3!important}
            .pdf-staff-box{background:#f8f8f8!important}
            .pdf-name-chip{background:#fff!important}
        }
    </style>
</head>
<body>

<!-- HEADER -->
<div class="hdr">
    <div>
        <div class="sub">Warehouse Operations</div>
        <div class="title">Daily Report</div>
    </div>
    <div class="hdr-btns">
        <button class="btn" id="btnToggle" onclick="togglePreview()">Preview ‚ñ∂</button>
    </div>
</div>

<div class="wrap">
    <div id="formBlock">

        <!-- META -->
        <div class="card">
            <div class="card-head"><span class="ico">üìÖ</span><span class="ttl">Report Info</span></div>
            <div class="card-body">
                <div class="row3">
                    <div><div class="lbl">Date</div><input type="date" id="rptDate"></div>
                    <div><div class="lbl">Warehouse / Location</div><input type="text" id="rptLocation" placeholder="e.g. Warehouse A"></div>
                    <div><div class="lbl">Prepared By</div><input type="text" id="rptAuthor" placeholder="Name"></div>
                </div>
            </div>
        </div>

        <!-- STAFF ON DUTY -->
        <div class="card">
            <div class="card-head"><span class="ico">üë∑</span><span class="ttl">Staff on Duty</span></div>
            <div class="card-body">
                <div class="workers-top">
                    <div class="lbl" style="margin:0">Number of workers:</div>
                    <div class="count-box">
                        <button class="count-btn" onclick="changeCount(-1)">‚àí</button>
                        <span class="count-val" id="countVal">4</span>
                        <button class="count-btn" onclick="changeCount(1)">+</button>
                    </div>
                </div>
                <div class="workers-head">
                    <div></div>
                    <div class="lbl">Worker Name</div>
                    <div class="lbl" style="text-align:center">Errors</div>
                    <div class="lbl">Notes</div>
                </div>
                <div class="workers-list" id="workersContainer"></div>
            </div>
        </div>

        <!-- DAILY WORK CONTENT -->
        <div class="card">
            <div class="card-head"><span class="ico">üìã</span><span class="ttl">Daily Work Content</span></div>
            <div class="card-body">
                <p class="hint">WHAT WAS DONE DURING THE DAY. ADD AS MANY TASKS AS NEEDED.</p>
                <div id="workContainer"></div>
                <button class="btn-ghost" onclick="addWork()">+ Add Task</button>
            </div>
        </div>

        <!-- CRITICAL INCIDENTS -->
        <div class="card">
            <div class="card-head"><span class="ico">üö®</span><span class="ttl">Critical Incidents</span></div>
            <div class="card-body">
                <p class="hint">SERIOUS INCIDENTS THAT OCCURRED DURING THE DAY ‚Äî INJURIES, MAJOR EQUIPMENT FAILURE, EMERGENCIES.</p>
                <div id="critContainer"></div>
                <button class="btn-ghost" onclick="addCrit()">+ Add Incident</button>
            </div>
        </div>

        <!-- ANOMALIES / HANDOVER -->
        <div class="card">
            <div class="card-head"><span class="ico">‚ö†Ô∏è</span><span class="ttl">Anomalies ‚Äî Shift Handover Reminders</span></div>
            <div class="card-body">
                <p class="hint">ANYTHING THE NEXT SHIFT MUST KNOW ABOUT.</p>
                <div id="anomalyContainer"></div>
                <button class="btn-ghost" onclick="addAnomaly()">+ Add Anomaly</button>
            </div>
        </div>

        <!-- SHEIN SUPPORT -->
        <div class="card">
            <div class="card-head"><span class="ico">üî¥</span><span class="ttl">Shein Support Required</span></div>
            <div class="card-body">
                <p class="hint">ISSUES REQUIRING SHEIN SUPPORT ‚Äî EQUIPMENT DAMAGE, MALFUNCTIONS, OPERATIONAL PROBLEMS.</p>
                <div id="sheinContainer"></div>
                <button class="btn-ghost" onclick="addShein()">+ Add Issue</button>
            </div>
        </div>

        <button class="btn-gen" onclick="togglePreview()">Generate Report ‚ñ∂</button>
    </div><!-- /formBlock -->

    <!-- PREVIEW -->
    <div id="previewBlock">
        <div class="prev-actions">
            <button class="btn" onclick="togglePreview()">‚óÄ Edit</button>
            <button class="btn-blue" onclick="window.print()">üñ® Save as PDF</button>
        </div>

        <div id="pdfDoc">

            <div class="pdh">
                <div class="pdh-brand">
                    <div class="s">Warehouse Operations</div>
                    <div class="t">DAILY REPORT</div>
                </div>
                <div class="pdh-meta">
                    <b id="pdf-date-loc"></b>
                    <span id="pdf-author"></span><br>
                    <span id="pdf-generated"></span>
                </div>
            </div>

            <!-- Staff -->
            <div class="pds">
                <div class="pds-title">üë∑ Staff on Duty</div>
                <table class="pdf-tbl" id="pdf-staff-table">
                    <thead><tr><th style="width:30px">#</th><th>Worker Name</th><th style="width:80px;text-align:center">Errors</th><th>Notes</th></tr></thead>
                    <tbody id="pdf-staff-names"></tbody>
                    <tfoot><tr><td colspan="3" id="pdf-staff-count" style="padding:7px 12px;font-family:'Share Tech Mono',monospace;font-size:10px;color:#999;background:#fafafa"></td></tr></tfoot>
                </table>
            </div>

            <!-- Work Content -->
            <div class="pds">
                <div class="pds-title">üìã Daily Work Content</div>
                <table class="pdf-tbl" id="pdf-work-table">
                    <thead><tr><th style="width:30px">#</th><th style="width:110px">Category</th><th>Task Description</th><th style="width:230px">Assigned To</th></tr></thead>
                    <tbody id="pdf-work-body"></tbody>
                </table>
                <div id="pdf-work-empty" style="font-size:12px;color:#aaa;padding:4px;display:none">No tasks recorded.</div>
            </div>

            <!-- Critical Incidents -->
            <div class="pds">
                <div class="pds-title">üö® Critical Incidents</div>
                <div id="pdf-crits"></div>
                <div id="pdf-crits-empty" style="font-size:12px;color:#aaa;padding:4px;display:none">No critical incidents recorded.</div>
            </div>

            <!-- Anomalies -->
            <div class="pds">
                <div class="pds-title">‚ö†Ô∏è Anomalies ‚Äî Shift Handover Reminders</div>
                <div id="pdf-anomalies"></div>
                <div id="pdf-anomalies-empty" style="font-size:12px;color:#aaa;padding:4px;display:none">No anomalies recorded.</div>
            </div>

            <!-- Shein -->
            <div class="pds">
                <div class="pds-title">üî¥ Shein Support Required</div>
                <div id="pdf-shein"></div>
                <div id="pdf-shein-empty" style="font-size:12px;color:#aaa;padding:4px;display:none">No support issues recorded.</div>
            </div>

            <div class="pdf-footer">
                <span>Warehouse Operations ‚Äî Daily Operations Report</span>
                <span id="pdf-footer-ts"></span>
            </div>

        </div><!-- /pdfDoc -->
    </div><!-- /previewBlock -->
</div><!-- /wrap -->

<script>
    // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let workerCount = 4;
    let workers = Array.from({length:4},(_,i)=>({name:`Worker ${i+1}`, errors:0, notes:''}));
    let works = [], anomalies = [], crits = [], sheins = [];
    let nid = 1;

    const WORK_CATS = ['Picking','Packing','Sorting','Loading','Unloading','Inventory','Inspection','Maintenance','Cleaning','Other'];
    const SHEIN_TYPES = ['Equipment Damage','Malfunction','Operational Issue','Safety Concern','Other'];

    window.onload = () => {
        document.getElementById('rptDate').valueAsDate = new Date();
        renderWorkers();
        addWork(); addCrit(); addAnomaly(); addShein();
    };

    // ‚îÄ‚îÄ Workers (inline chips) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function changeCount(d) {
        const n = Math.max(1, Math.min(30, workerCount + d));
        if(n > workerCount) for(let i=workerCount;i<n;i++) workers.push({name:`Worker ${i+1}`, errors:0, notes:''});
        else workers = workers.slice(0, n);
        workerCount = n;
        document.getElementById('countVal').textContent = n;
        renderWorkers();
    }

    function renderWorkers() {
        const c = document.getElementById('workersContainer');
        c.innerHTML = '';
        workers.forEach((w, i) => {
            const row = document.createElement('div');
            row.className = 'worker-row';
            row.innerHTML = `
      <span class="worker-num">${i+1}</span>
      <input value="${esc(w.name)}" placeholder="Worker name" oninput="workers[${i}].name=this.value">
      <input type="number" min="0" value="${w.errors}" oninput="workers[${i}].errors=+this.value"
        style="text-align:center;font-family:'Share Tech Mono',monospace;color:#ff6b35">
      <input value="${esc(w.notes)}" placeholder="Notes..." oninput="workers[${i}].notes=this.value">`;
            c.appendChild(row);
        });
    }

    // ‚îÄ‚îÄ Work Content ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addWork(){const id=nid++;works.push({id,cat:'Other',desc:'',assignedTo:''});renderWorks();}
    function removeWork(id){works=works.filter(w=>w.id!==id);renderWorks();}
    function setWork(id,f,v){const w=works.find(w=>w.id===id);if(w)w[f]=v;}
    function setWorkCat(id,cat,el){
        const w=works.find(w=>w.id===id);if(!w)return;w.cat=cat;
        el.closest('.work-item').querySelectorAll('.cat-tag').forEach(t=>t.classList.remove('sel'));
        el.classList.add('sel');
    }
    function renderWorks(){
        const c=document.getElementById('workContainer');c.innerHTML='';
        works.forEach((w,i)=>{
            const div=document.createElement('div');div.className='work-item';
            div.innerHTML=`
      <div class="work-top">
        <span class="work-num">${i+1}.</span>
        ${WORK_CATS.map(cat=>`<span class="cat-tag${w.cat===cat?' sel':''}" onclick="setWorkCat(${w.id},'${cat}',this)">${cat}</span>`).join('')}
        <div style="flex:1"></div>
        <button class="btn-x" onclick="removeWork(${w.id})">√ó</button>
      </div>
      <div class="work-fields">
        <div style="flex:3"><div class="lbl">Description</div>
          <textarea rows="2" placeholder="What was done..." oninput="setWork(${w.id},'desc',this.value)">${esc(w.desc)}</textarea></div>
        <div style="flex:1"><div class="lbl">Assigned To</div>
          <input value="${esc(w.assignedTo)}" placeholder="Worker(s)" oninput="setWork(${w.id},'assignedTo',this.value)"></div>
      </div>`;
            c.appendChild(div);
        });
    }

    // ‚îÄ‚îÄ Critical Incidents ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addCrit(){const id=nid++;crits.push({id,desc:'',action:''});renderCrits();}
    function removeCrit(id){crits=crits.filter(c=>c.id!==id);renderCrits();}
    function setCrit(id,f,v){const c=crits.find(c=>c.id===id);if(c)c[f]=v;}
    function renderCrits(){
        const c=document.getElementById('critContainer');c.innerHTML='';
        crits.forEach((cr,i)=>{
            const div=document.createElement('div');div.className='crit-card';
            div.innerHTML=`
      <div class="crit-top">
        <span style="font-family:'Share Tech Mono',monospace;font-size:10px;color:#9b2335;font-weight:700">üö® INCIDENT #${i+1}</span>
        <div style="flex:1"></div>
        <button class="btn-x" onclick="removeCrit(${cr.id})">√ó</button>
      </div>
      <div style="display:flex;gap:10px">
        <div style="flex:2"><div class="lbl">Incident Description</div>
          <textarea rows="2" placeholder="Describe what happened..." oninput="setCrit(${cr.id},'desc',this.value)">${esc(cr.desc)}</textarea></div>
        <div style="flex:1"><div class="lbl">Action Taken</div>
          <textarea rows="2" placeholder="What was done..." oninput="setCrit(${cr.id},'action',this.value)">${esc(cr.action)}</textarea></div>
      </div>`;
            c.appendChild(div);
        });
    }

    // ‚îÄ‚îÄ Anomalies ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addAnomaly(){const id=nid++;anomalies.push({id,severity:'warning',desc:'',action:''});renderAnomalies();}
    function removeAnomaly(id){anomalies=anomalies.filter(a=>a.id!==id);renderAnomalies();}
    function setAnomaly(id,f,v){const a=anomalies.find(a=>a.id===id);if(a)a[f]=v;}
    function setAnomalySev(id,v){const a=anomalies.find(a=>a.id===id);if(a){a.severity=v;renderAnomalies();}}
    function renderAnomalies(){
        const c=document.getElementById('anomalyContainer');c.innerHTML='';
        anomalies.forEach((a,i)=>{
            const cls=a.severity==='warning'?'warning':'info';
            const div=document.createElement('div');div.className=`anom-card ${cls}`;
            div.innerHTML=`
      <div class="anom-top">
        <span style="font-family:'Share Tech Mono',monospace;font-size:10px;color:#444">#${i+1}</span>
        <select style="width:auto" onchange="setAnomalySev(${a.id},this.value)">
          <option value="warning" ${a.severity==='warning'?'selected':''}>üü° Warning</option>
          <option value="info"    ${a.severity==='info'?'selected':''}>üîµ Info</option>
        </select>
        <div style="flex:1"></div>
        <button class="btn-x" onclick="removeAnomaly(${a.id})">√ó</button>
      </div>
      <div style="display:flex;gap:10px">
        <div style="flex:2"><div class="lbl">Description</div>
          <textarea rows="2" placeholder="Describe the anomaly..." oninput="setAnomaly(${a.id},'desc',this.value)">${esc(a.desc)}</textarea></div>
        <div style="flex:1"><div class="lbl">Action / Reminder for next shift</div>
          <textarea rows="2" placeholder="What next shift should do..." oninput="setAnomaly(${a.id},'action',this.value)">${esc(a.action)}</textarea></div>
      </div>`;
            c.appendChild(div);
        });
    }

    // ‚îÄ‚îÄ Shein Support ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addShein(){const id=nid++;sheins.push({id,type:'Equipment Damage',desc:'',ticketNo:''});renderSheins();}
    function removeShein(id){sheins=sheins.filter(s=>s.id!==id);renderSheins();}
    function setShein(id,f,v){const s=sheins.find(s=>s.id===id);if(s)s[f]=v;}
    function setSheinType(id,v){const s=sheins.find(s=>s.id===id);if(s){s.type=v;renderSheins();}}
    function typeEmoji(t){return t==='Equipment Damage'?'üîß':t==='Malfunction'?'‚öôÔ∏è':t==='Safety Concern'?'ü¶∫':t==='Operational Issue'?'üì¶':'üìå';}
    function renderSheins(){
        const c=document.getElementById('sheinContainer');c.innerHTML='';
        sheins.forEach((s,i)=>{
            const div=document.createElement('div');div.className='shein-card';
            div.innerHTML=`
      <div class="shein-top">
        <span style="font-family:'Share Tech Mono',monospace;font-size:10px;color:#8e44ad">#${i+1}</span>
        <select style="width:auto" onchange="setSheinType(${s.id},this.value)">
          ${SHEIN_TYPES.map(t=>`<option value="${t}" ${s.type===t?'selected':''}>${typeEmoji(t)} ${t}</option>`).join('')}
        </select>
        <div style="flex:1"></div>
        <button class="btn-x" onclick="removeShein(${s.id})">√ó</button>
      </div>
      <div style="display:flex;gap:10px">
        <div style="flex:3"><div class="lbl">Issue Description</div>
          <textarea rows="2" placeholder="Describe the problem..." oninput="setShein(${s.id},'desc',this.value)">${esc(s.desc)}</textarea></div>
        <div style="flex:1"><div class="lbl">Ticket / Ref No.</div>
          <input value="${esc(s.ticketNo)}" placeholder="#TKT-1042" oninput="setShein(${s.id},'ticketNo',this.value)"></div>
      </div>`;
            c.appendChild(div);
        });
    }

    // ‚îÄ‚îÄ Build PDF ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function buildPDF(){
        const date=document.getElementById('rptDate').value;
        const loc=document.getElementById('rptLocation').value;
        const author=document.getElementById('rptAuthor').value;
        const now=new Date().toLocaleString();
        const dateStr=date?new Date(date+'T00:00:00').toLocaleDateString('en-GB',{day:'2-digit',month:'long',year:'numeric'}):'‚Äî';

        document.getElementById('pdf-date-loc').textContent=dateStr+(loc?' ¬∑ '+loc:'');
        document.getElementById('pdf-author').textContent=author?'Prepared by: '+author:'';
        document.getElementById('pdf-generated').textContent='Generated: '+now;
        document.getElementById('pdf-footer-ts').textContent=now;

        // Staff ‚Äî table with errors
        const sn=document.getElementById('pdf-staff-names');
        const sc=document.getElementById('pdf-staff-count');
        let totalErr=0;
        sn.innerHTML=workers.map((w,i)=>{
            const e=+w.errors||0; totalErr+=e;
            return `<tr>
      <td style="font-family:'Share Tech Mono',monospace;color:#bbb;width:30px">${i+1}</td>
      <td style="font-weight:600">${w.name}</td>
      <td style="text-align:center;font-family:'Share Tech Mono',monospace;font-weight:700;color:${e>0?'#c0392b':'#27ae60'}">${e>0?e:'‚Äî'}</td>
      <td style="font-size:11.5px;color:#777">${w.notes||'‚Äî'}</td>
    </tr>`;
        }).join('');
        sc.textContent=`Total: ${workers.length} workers on duty ¬∑ ${totalErr} total error${totalErr!==1?'s':''}`;

        // Work
        const wb=document.getElementById('pdf-work-body');
        const we=document.getElementById('pdf-work-empty');
        const wt=document.getElementById('pdf-work-table');
        wb.innerHTML='';
        const dw=works.filter(w=>w.desc.trim());
        if(dw.length){
            we.style.display='none';wt.style.display='table';
            dw.forEach((w,i)=>{
                wb.innerHTML+=`<tr>
        <td style="font-family:'Share Tech Mono',monospace;color:#bbb">${i+1}</td>
        <td><span class="chip">${w.cat}</span></td>
        <td>${w.desc.trim()}</td>
        <td style="font-size:11.5px;color:#777">${w.assignedTo||'‚Äî'}</td>
      </tr>`;
            });
        } else {we.style.display='block';wt.style.display='none';}

        // Critical incidents
        const crEl=document.getElementById('pdf-crits');
        const ceEl=document.getElementById('pdf-crits-empty');
        crEl.innerHTML='';
        const dc=crits.filter(c=>c.desc.trim());
        if(dc.length){
            ceEl.style.display='none';
            dc.forEach((cr,i)=>{
                crEl.innerHTML+=`<div class="pdf-item crit">
        <div class="pdf-item-head"><span class="badge b-crit">üö® Critical Incident #${i+1}</span></div>
        <div class="pdf-item-text">${cr.desc.trim()}</div>
        ${cr.action.trim()?`<div class="pdf-item-sub">‚ûú Action taken: ${cr.action.trim()}</div>`:''}
      </div>`;
            });
        } else {ceEl.style.display='block';}

        // Anomalies
        const ac=document.getElementById('pdf-anomalies');
        const ae=document.getElementById('pdf-anomalies-empty');
        ac.innerHTML='';
        const da=anomalies.filter(a=>a.desc.trim());
        if(da.length){
            ae.style.display='none';
            da.forEach(a=>{
                const badge=a.severity==='warning'?`<span class="badge b-warn">üü° Warning</span>`:`<span class="badge b-info">üîµ Info</span>`;
                const cls=a.severity==='warning'?'warn':'info';
                ac.innerHTML+=`<div class="pdf-item ${cls}">
        <div class="pdf-item-head">${badge}</div>
        <div class="pdf-item-text">${a.desc.trim()}</div>
        ${a.action.trim()?`<div class="pdf-item-sub">‚ûú Reminder for next shift: ${a.action.trim()}</div>`:''}
      </div>`;
            });
        } else {ae.style.display='block';}

        // Shein
        const sh=document.getElementById('pdf-shein');
        const se=document.getElementById('pdf-shein-empty');
        sh.innerHTML='';
        const ds=sheins.filter(s=>s.desc.trim());
        if(ds.length){
            se.style.display='none';
            ds.forEach(s=>{
                const bCls=s.type==='Equipment Damage'?'b-equip':s.type==='Safety Concern'?'b-safety':s.type==='Operational Issue'?'b-ops':'b-other';
                sh.innerHTML+=`<div class="pdf-item shein">
        <div class="pdf-item-head">
          <span class="badge ${bCls}">${typeEmoji(s.type)} ${s.type}</span>
          ${s.ticketNo?`<span class="badge b-other">${s.ticketNo}</span>`:''}
        </div>
        <div class="pdf-item-text">${s.desc.trim()}</div>
      </div>`;
            });
        } else {se.style.display='block';}
    }

    // ‚îÄ‚îÄ Toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function togglePreview(){
        const showing=document.getElementById('formBlock').style.display!=='none';
        if(showing){
            buildPDF();
            document.getElementById('formBlock').style.display='none';
            document.getElementById('previewBlock').style.display='block';
            document.getElementById('btnToggle').textContent='‚óÄ Edit';
            document.getElementById('btnToggle').classList.add('on');
            window.scrollTo(0,0);
        } else {
            document.getElementById('formBlock').style.display='block';
            document.getElementById('previewBlock').style.display='none';
            document.getElementById('btnToggle').textContent='Preview ‚ñ∂';
            document.getElementById('btnToggle').classList.remove('on');
        }
    }

    function esc(s){return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
</script>
</body>
</html>